(function(exports){var unid=0;var vendors="t,webkitT,MozT,msT,OT".split(",");var vendorsCSS="t,-webkit-t,-moz-t,-ms-t,-o-t".split(",");var performance=window.performance||{};if(!Function.bind)Function.prototype.bind=function(){var __method=this;var args=Array.prototype.slice.call(arguments);var object=args.shift();return function(){return __method.apply(object,args.concat(Array.prototype.slice.call(arguments)))}};var judge=function(vendors){var dummyStyle=document.createElement("div").style;var v=
"t,webkitT,MozT,msT,OT".split(","),t,i=0,l=vendors.length;for(;i<l;i++){t=v[i]+"ransform";if(t in dummyStyle)return vendors[i].substr(0,vendors[i].length-1)}return false};var prefixStyle=function(style){var vendor=judge(vendors);if(vendor==="")return style;style=style.charAt(0).toUpperCase()+style.substr(1);return vendor+style};var prefixCSS=function(style){var vendor=judge(vendorsCSS);if(vendor==="")return style;style=style.charAt(0)+style.substr(1);return vendor+style};var bindEvt=function(elem,
event,handler){if(elem.addEventListener)elem.addEventListener(event,handler,false);else elem.attachEvent("on"+event,function(){handler.call(elem,window.event)})};var extend=function(obj,ext){for(var p in ext)obj[p]=ext[p];return obj};var indexOf=function(array,item){if(array.indexOf)return array.indexOf(item);else{for(var i=0,p;p=array[i];i++)if(p===item)return i;return-1}};var requestAnimationFrame=window[prefixStyle("requestAnimationFrame")]||function(callback){setTimeout(callback,17)};var cssAnimation=
document.createElement("style");cssAnimation.setAttribute("id","ex_animate_style");cssAnimation.type="text/css";document.getElementsByTagName("head")[0].appendChild(cssAnimation);var Animate=function(){this._init.apply(this,arguments)};Animate.prototype={css:document.getElementById("ex_animate_style"),_keywords:["point","timing"],_events:[],_method:null,_currentFrame:0,_needStop:false,_init:function(elem,opts){opts=opts||{};this.elem=elem;this.options=extend({},opts);this.events={};this.keyframes=
[];this.keyframesString=[];this.uniqId=++unid;var dummyStyle=document.createElement("div").style;var transform=prefixStyle("transform");var transition=prefixStyle("transition");var animation=prefixStyle("animation");if(transition in dummyStyle)this.options.transition=true;if(animation in dummyStyle)this.options.animation=true;if(this.options.animation){var rules=document.createTextNode("");this.css.appendChild(rules);this.keyframeElement=rules}},setElement:function(elem){this.elem=elem;return this},
_getProperty:function(frame){var obj={};for(var p in frame)if(indexOf(this._keywords,p)==-1)obj[p]=frame[p];return obj},keyframe:function(frames){this.keyframes=this.keyframes.concat(frames);return this},reset:function(){this.keyframes=[];this.elem.style[prefixStyle("animation")]="";this.elem.style[prefixStyle("transitionProperty")]="";this.elem.style[prefixStyle("transitionTimingFunction")]="";this.elem.style[prefixStyle("transitionDuration")]="";return this},start:function(opt){var self=this;opt=
this._startOpt||extend({timing:"linear"},opt);this._startOpt=opt;var object2String=function(obj){var str="{",j=0;for(var i in obj){if(j++>0)str+=";";str=str+i+":"+obj[i]}return str+"}"};this._currentFrame=0;var aniFunction=function(){var duration=this.keyframes[this.keyframes.length-1].point;var keyFrameName="key"+this.uniqId;var aniString="{";for(var i=0,f;f=this.keyframes[i];i++)aniString+=Math.round(f.point/duration*100)+"% "+object2String(this._getProperty(f));aniString+="}";var data="@"+prefixCSS("keyframes")+
" "+keyFrameName+aniString;if(data!=this.keyframeElement.data)this.keyframeElement.data=data;this.elem.style[prefixStyle("animation")]=keyFrameName+" "+duration+"ms "+opt.timing;var lastFrame=this._getProperty(this.keyframes[this.keyframes.length-1]);for(var p in lastFrame)this.elem.style[p]=lastFrame[p];bindEvt(this.elem,prefixStyle("animationEnd"),function(evt){self.events.animationEnd&&self.events.animationEnd.bind(self)(evt)})};var transFunction=function(){var iteration=this._currentFrame;var trans=
function(frame1,frame2){var frames=[frame1,frame2];var property=[];for(var j=0;j<=1;j++){var frame=this._getProperty(frames[j]);for(var p in frame)if(indexOf(property,p)==-1)property.push(p)}this.elem.style[prefixStyle("transitionDuration")]=0;var firstFrame=this._getProperty(frame1);for(var p in firstFrame)this.elem.style[p]=firstFrame[p];this.elem.style[prefixStyle("transitionProperty")]=property.join(",");this.elem.style[prefixStyle("transitionTimingFunction")]=opt.timing;if(opt.accelerate)this.elem.style[prefixStyle("transform")]=
"translateZ(0)";var _this=this;var time=setTimeout(function(){_this.elem.style[prefixStyle("transitionDuration")]=(frame2.point-frame1.point)/1E3+"s";var secondFrame=_this._getProperty(frame2);for(var p in secondFrame)_this.elem.style[p]=secondFrame[p];clearTimeout(time)},100)};if(this.keyframes.length==1){var frame1=this.keyframes[0];if(frame1.point>0)this.keyframes.unshift({point:0})}if(this.keyframes.length>1){var frame1=this.keyframes[0];var frame2=this.keyframes[1];trans.bind(this)(frame1,frame2);
iteration++;bindEvt(this.elem,"transitionend",function(evt){if(self.keyframes[iteration+1]){var frame1=self.keyframes[iteration];var frame2=self.keyframes[iteration+1];trans.bind(self)(frame1,frame2);iteration++}else self.events.animationEnd&&self.events.animationEnd.bind(self)(evt)})}};var timeFunction=function(){var iteration=0;var trans=function(frame1,frame2){var property=[];var interval=[];var unit=[];var ratio=0;var prop1=this._getProperty(frame1);var prop2=this._getProperty(frame2);for(var p in prop1)if(prop2[p]!=
null){var start=parseFloat(prop1[p].toString().replace(/[^\d+-]/g,""));var end=parseFloat(prop2[p].toString().replace(/[^\d+-]/g,""));property.push({prop:p,start:start,end:end,unit:(prop2[p]=="0"?prop1[p]:prop2[p]).toString().replace(/[\D]*\d+(?=[a-z]*)/gi,"")})}var setValue=function(ratio){for(var i=0,p;p=property[i];i++)if(ratio==-1){if(/opacity/i.test(p.prop))this.elem.style["filter"]="alpha(opacity="+p.end*100+")";this.elem.style[p.prop]=p.end+p.unit}else{var value=(p.start+(p.end-p.start)*ratio).toFixed(1);
if(/opacity/i.test(p.prop))this.elem.style["filter"]="alpha(opacity="+value*100+")";this.elem.style[p.prop]=value+p.unit}};var animationEnd=function(){if(this.keyframes[iteration+1]){trans.bind(this)(this.keyframes[iteration],this.keyframes[iteration+1]);iteration++}else self.events.animationEnd&&self.events.animationEnd.bind(self)()};setValue.bind(this)(0);if(this.keyframes.length==1){var frame1=this.keyframes[0];if(frame1.point>0)this.keyframes.unshift({point:0})}var maxDuration=frame2.point-frame1.point;
var pauseTime=0;var nextFrame=function(){var drawStart=performance.now?performance.now():+new Date;var pass=drawStart-startTime-pauseTime;setValue.bind(self)(pass/maxDuration);if(pass<maxDuration)if(!self._needStop)requestAnimationFrame(nextFrame);else{var pauseTimePoint=performance.now?performance.now():+new Date;pauseTime=0;self._continueFunc=function(){pauseTime=(performance.now?performance.now():+new Date)-pauseTimePoint;requestAnimationFrame(nextFrame)}}else{setValue.bind(self)(-1);animationEnd.bind(self)()}};
var startTime=performance.now?performance.now():+new Date;requestAnimationFrame(nextFrame)};this._currentFrame=iteration;trans.bind(this)(this.keyframes[iteration],this.keyframes[iteration+1]);iteration++};if(opt.method)switch(opt.method){case "animation":if(this.options.animation)aniFunction.bind(this)();else console.log("your browser does not support animation method.");break;case "transition":if(this.options.transition)transFunction.bind(this)();else console.log("your browser does not support transition method.");
break;case "time":timeFunction.bind(this)();break}else if(this.options.transition)transFunction.bind(this)();else if(this.options.animation)aniFunction.bind(this)();else timeFunction.bind(this)();return this},clear:function(){for(var i=0,length=this.keyframes.length;i<length;i++){var frame=this._getProperty(this.keyframes[i]);for(var p in frame)this.elem.style[p]=""}return this},on:function(event,cb){if(event=="animationend")this.events.animationEnd=cb;else bindEvt(this.elem,event,cb);return this},
stop:function(){this._needStop=true;this._currentFrame=0;return this},pause:function(){this._needStop=true;return this},continuePlay:function(){if(this._needStop==true)if(this._startOpt&&this._startOpt.method=="time"){this._needStop=false;this._continueFunc&&this._continueFunc();this._continueFunc=null}else{this._needStop=false;this.clear();this.start()}return this}};exports.Animate=Animate})(window);
